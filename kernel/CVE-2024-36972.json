{
    "CVE-ID": "CVE-2024-36972",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\naf_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.\n\nBilly Jheng Bing-Jhong reported a race between __unix_gc() and\nqueue_oob().\n\n__unix_gc() tries to garbage-collect close()d inflight sockets,\nand then if the socket has MSG_OOB in unix_sk(sk)->oob_skb, GC\nwill drop the reference and set NULL to it locklessly.\n\nHowever, the peer socket still can send MSG_OOB message and\nqueue_oob() can update unix_sk(sk)->oob_skb concurrently, leading\nNULL pointer dereference. [0]\n\nTo fix the issue, let's update unix_sk(sk)->oob_skb under the\nsk_receive_queue's lock and take it everywhere we touch oob_skb.\n\nNote that we defer kfree_skb() in manage_oob() to silence lockdep\nfalse-positive (See [1]).\n\n[0]:\nBUG: kernel NULL pointer dereference, address: 0000000000000008\n PF: supervisor write access in kernel mode\n PF: error_code(0x0002) - not-present page\nPGD 8000000009f5e067 P4D 8000000009f5e067 PUD 9f5d067 PMD 0\nOops: 0002 [#1] PREEMPT SMP PTI\nCPU: 3 PID: 50 Comm: kworker/3:1 Not tainted 6.9.0-rc5-00191-gd091e579b864 #110\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014\nWorkqueue: events delayed_fput\nRIP: 0010:skb_dequeue (./include/linux/skbuff.h:2386 ./include/linux/skbuff.h:2402 net/core/skbuff.c:3847)\nCode: 39 e3 74 3e 8b 43 10 48 89 ef 83 e8 01 89 43 10 49 8b 44 24 08 49 c7 44 24 08 00 00 00 00 49 8b 14 24 49 c7 04 24 00 00 00 00 <48> 89 42 08 48 89 10 e8 e7 c5 42 00 4c 89 e0 5b 5d 41 5c c3 cc cc\nRSP: 0018:ffffc900001bfd48 EFLAGS: 00000002\nRAX: 0000000000000000 RBX: ffff8880088f5ae8 RCX: 00000000361289f9\nRDX: 0000000000000000 RSI: 0000000000000206 RDI: ffff8880088f5b00\nRBP: ffff8880088f5b00 R08: 0000000000080000 R09: 0000000000000001\nR10: 0000000000000003 R11: 0000000000000001 R12: ffff8880056b6a00\nR13: ffff8880088f5280 R14: 0000000000000001 R15: ffff8880088f5a80\nFS:  0000000000000000(0000) GS:ffff88807dd80000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000000000000008 CR3: 0000000006314000 CR4: 00000000007506f0\nPKRU: 55555554\nCall Trace:\n <TASK>\n unix_release_sock (net/unix/af_unix.c:654)\n unix_release (net/unix/af_unix.c:1050)\n __sock_release (net/socket.c:660)\n sock_close (net/socket.c:1423)\n __fput (fs/file_table.c:423)\n delayed_fput (fs/file_table.c:444 (discriminator 3))\n process_one_work (kernel/workqueue.c:3259)\n worker_thread (kernel/workqueue.c:3329 kernel/workqueue.c:3416)\n kthread (kernel/kthread.c:388)\n ret_from_fork (arch/x86/kernel/process.c:153)\n ret_from_fork_asm (arch/x86/entry/entry_64.S:257)\n </TASK>\nModules linked in:\nCR2: 0000000000000008",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 7.5,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.15.149",
                "VersionEndExcluding": "5.15.161",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.1.78",
                "VersionEndExcluding": "6.1.93",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.6.17",
                "VersionEndExcluding": "6.6.33",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.7.5",
                "VersionEndExcluding": "6.9.4",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "5.15.161": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.161"
            ]
        },
        "6.1.93": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.93"
            ]
        },
        "6.10": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.10"
            ]
        },
        "6.6.33": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.33"
            ]
        },
        "6.9.4": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.9.4"
            ]
        },
        "commit": {
            "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.": [
                {
                    "description": "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.",
                    "commit": "518a994aa0b87d96f1bc6678a7035df5d1fcd7a1",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.161",
                    "version": "5.15.161",
                    "upstream_commit": "9841991a446c87f90f66f4b9fee6fe934c1336a2",
                    "fixed": [
                        {
                            "fixed_commit": "1279f9d9dec2",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "4fe505c63aa3",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.149",
                            "fixed_commit_version": "5.15.149",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "e0e09186d882",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.78",
                            "fixed_commit_version": "6.1.78",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "b74aa9ce13d0",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.17",
                            "fixed_commit_version": "6.6.17",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "82ae47c5c3a6",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.7.5",
                            "fixed_commit_version": "6.7.5",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        }
                    ]
                },
                {
                    "description": "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.",
                    "commit": "4bf6964451c3cb411fbaa1ae8b214b3d97a59bf1",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.93",
                    "version": "6.1.93",
                    "upstream_commit": "9841991a446c87f90f66f4b9fee6fe934c1336a2",
                    "fixed": [
                        {
                            "fixed_commit": "1279f9d9dec2",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "4fe505c63aa3",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.149",
                            "fixed_commit_version": "5.15.149",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "e0e09186d882",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.78",
                            "fixed_commit_version": "6.1.78",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "b74aa9ce13d0",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.17",
                            "fixed_commit_version": "6.6.17",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "82ae47c5c3a6",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.7.5",
                            "fixed_commit_version": "6.7.5",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        }
                    ]
                },
                {
                    "description": "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.",
                    "commit": "9841991a446c87f90f66f4b9fee6fe934c1336a2",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.10",
                    "version": "6.10",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "1279f9d9dec2",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "4fe505c63aa3",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.149",
                            "fixed_commit_version": "5.15.149",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "e0e09186d882",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.78",
                            "fixed_commit_version": "6.1.78",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "b74aa9ce13d0",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.17",
                            "fixed_commit_version": "6.6.17",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "82ae47c5c3a6",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.7.5",
                            "fixed_commit_version": "6.7.5",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        }
                    ]
                },
                {
                    "description": "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.",
                    "commit": "d59ae9314b97e01c76a4171472441e55721ba636",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.33",
                    "version": "6.6.33",
                    "upstream_commit": "9841991a446c87f90f66f4b9fee6fe934c1336a2",
                    "fixed": [
                        {
                            "fixed_commit": "1279f9d9dec2",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "4fe505c63aa3",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.149",
                            "fixed_commit_version": "5.15.149",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "e0e09186d882",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.78",
                            "fixed_commit_version": "6.1.78",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "b74aa9ce13d0",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.17",
                            "fixed_commit_version": "6.6.17",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "82ae47c5c3a6",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.7.5",
                            "fixed_commit_version": "6.7.5",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        }
                    ]
                },
                {
                    "description": "af_unix: Update unix_sk(sk)->oob_skb under sk_receive_queue lock.",
                    "commit": "4708f49add84a57ce0ccc7bf9a6269845c631cc3",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.9.4",
                    "version": "6.9.4",
                    "upstream_commit": "9841991a446c87f90f66f4b9fee6fe934c1336a2",
                    "fixed": [
                        {
                            "fixed_commit": "1279f9d9dec2",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "4fe505c63aa3",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.149",
                            "fixed_commit_version": "5.15.149",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "e0e09186d882",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.78",
                            "fixed_commit_version": "6.1.78",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "b74aa9ce13d0",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.17",
                            "fixed_commit_version": "6.6.17",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        },
                        {
                            "fixed_commit": "82ae47c5c3a6",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.7.5",
                            "fixed_commit_version": "6.7.5",
                            "fixed_commit_upstream_commit": "1279f9d9dec2d7462823a18c29ad61359e0a007d"
                        }
                    ]
                }
            ]
        }
    }
}