{
    "CVE-ID": "CVE-2024-56552",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\ndrm/xe/guc_submit: fix race around suspend_pending\n\nCurrently in some testcases we can trigger:\n\nxe 0000:03:00.0: [drm] Assertion `exec_queue_destroyed(q)` failed!\n....\nWARNING: CPU: 18 PID: 2640 at drivers/gpu/drm/xe/xe_guc_submit.c:1826 xe_guc_sched_done_handler+0xa54/0xef0 [xe]\nxe 0000:03:00.0: [drm] *ERROR* GT1: DEREGISTER_DONE: Unexpected engine state 0x00a1, guc_id=57\n\nLooking at a snippet of corresponding ftrace for this GuC id we can see:\n\n162.673311: xe_sched_msg_add:     dev=0000:03:00.0, gt=1 guc_id=57, opcode=3\n162.673317: xe_sched_msg_recv:    dev=0000:03:00.0, gt=1 guc_id=57, opcode=3\n162.673319: xe_exec_queue_scheduling_disable: dev=0000:03:00.0, 1:0x2, gt=1, width=1, guc_id=57, guc_state=0x29, flags=0x0\n162.674089: xe_exec_queue_kill:   dev=0000:03:00.0, 1:0x2, gt=1, width=1, guc_id=57, guc_state=0x29, flags=0x0\n162.674108: xe_exec_queue_close:  dev=0000:03:00.0, 1:0x2, gt=1, width=1, guc_id=57, guc_state=0xa9, flags=0x0\n162.674488: xe_exec_queue_scheduling_done: dev=0000:03:00.0, 1:0x2, gt=1, width=1, guc_id=57, guc_state=0xa9, flags=0x0\n162.678452: xe_exec_queue_deregister: dev=0000:03:00.0, 1:0x2, gt=1, width=1, guc_id=57, guc_state=0xa1, flags=0x0\n\nIt looks like we try to suspend the queue (opcode=3), setting\nsuspend_pending and triggering a disable_scheduling. The user then\ncloses the queue. However the close will also forcefully signal the\nsuspend fence after killing the queue, later when the G2H response for\ndisable_scheduling comes back we have now cleared suspend_pending when\nsignalling the suspend fence, so the disable_scheduling now incorrectly\ntries to also deregister the queue. This leads to warnings since the queue\nhas yet to even be marked for destruction. We also seem to trigger\nerrors later with trying to double unregister the same queue.\n\nTo fix this tweak the ordering when handling the response to ensure we\ndon't race with a disable_scheduling that didn't actually intend to\nperform an unregister.  The destruction path should now also correctly\nwait for any pending_disable before marking as destroyed.\n\n(cherry picked from commit f161809b362f027b6d72bd998e47f8f0bad60a2e)",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 4.7,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.8",
                "VersionEndExcluding": "6.12.4",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "6.12.4": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.4"
            ]
        },
        "6.13": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13"
            ]
        },
        "6.14": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14"
            ]
        },
        "commit": {
            "drm/xe/guc_submit: fix race around suspend_pending": [
                {
                    "description": "drm/xe/guc_submit: fix race around suspend_pending",
                    "commit": "5ddcb50b700221fa7d7be2adcb3d7d7afe8633dd",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.4",
                    "version": "6.12.4",
                    "upstream_commit": "87651f31ae4e6e6e7e6c7270b9b469405e747407",
                    "fixed": [
                        {
                            "fixed_commit": "dd08ebf6c352",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "drm/xe/guc_submit: fix race around suspend_pending",
                    "commit": "87651f31ae4e6e6e7e6c7270b9b469405e747407",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13",
                    "version": "6.13",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "dd08ebf6c352",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "drm/xe/guc_submit: fix race around suspend_pending",
                    "commit": "f161809b362f027b6d72bd998e47f8f0bad60a2e",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14",
                    "version": "6.14",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "dd08ebf6c352",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.8",
                            "fixed_commit_version": "6.8",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}