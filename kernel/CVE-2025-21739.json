{
    "CVE-ID": "CVE-2025-21739",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nscsi: ufs: core: Fix use-after free in init error and remove paths\n\ndevm_blk_crypto_profile_init() registers a cleanup handler to run when\nthe associated (platform-) device is being released. For UFS, the\ncrypto private data and pointers are stored as part of the ufs_hba's\ndata structure 'struct ufs_hba::crypto_profile'. This structure is\nallocated as part of the underlying ufshcd and therefore Scsi_host\nallocation.\n\nDuring driver release or during error handling in ufshcd_pltfrm_init(),\nthis structure is released as part of ufshcd_dealloc_host() before the\n(platform-) device associated with the crypto call above is released.\nOnce this device is released, the crypto cleanup code will run, using\nthe just-released 'struct ufs_hba::crypto_profile'. This causes a\nuse-after-free situation:\n\n  Call trace:\n   kfree+0x60/0x2d8 (P)\n   kvfree+0x44/0x60\n   blk_crypto_profile_destroy_callback+0x28/0x70\n   devm_action_release+0x1c/0x30\n   release_nodes+0x6c/0x108\n   devres_release_all+0x98/0x100\n   device_unbind_cleanup+0x20/0x70\n   really_probe+0x218/0x2d0\n\nIn other words, the initialisation code flow is:\n\n  platform-device probe\n    ufshcd_pltfrm_init()\n      ufshcd_alloc_host()\n        scsi_host_alloc()\n          allocation of struct ufs_hba\n          creation of scsi-host devices\n    devm_blk_crypto_profile_init()\n      devm registration of cleanup handler using platform-device\n\nand during error handling of ufshcd_pltfrm_init() or during driver\nremoval:\n\n  ufshcd_dealloc_host()\n    scsi_host_put()\n      put_device(scsi-host)\n        release of struct ufs_hba\n  put_device(platform-device)\n    crypto cleanup handler\n\nTo fix this use-after free, change ufshcd_alloc_host() to register a\ndevres action to automatically cleanup the underlying SCSI device on\nufshcd destruction, without requiring explicit calls to\nufshcd_dealloc_host(). This way:\n\n    * the crypto profile and all other ufs_hba-owned resources are\n      destroyed before SCSI (as they've been registered after)\n    * a memleak is plugged in tc-dwc-g210-pci.c remove() as a\n      side-effect\n    * EXPORT_SYMBOL_GPL(ufshcd_dealloc_host) can be removed fully as\n      it's not needed anymore\n    * no future drivers using ufshcd_alloc_host() could ever forget\n      adding the cleanup",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 7.8,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel:6.14:rc1",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.12",
                "VersionEndExcluding": "6.12.14",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.13",
                "VersionEndExcluding": "6.13.3",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "6.12.14": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.14"
            ]
        },
        "6.13.3": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13.3"
            ]
        },
        "6.14": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14"
            ]
        },
        "commit": {
            "scsi: ufs: core: Fix use-after free in init error and remove paths": [
                {
                    "description": "scsi: ufs: core: Fix use-after free in init error and remove paths",
                    "commit": "0c77c0d754fe83cb154715fcfec6c3faef94f207",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.14",
                    "version": "6.12.14",
                    "upstream_commit": "f8fb2403ddebb5eea0033d90d9daae4c88749ada",
                    "fixed": [
                        {
                            "fixed_commit": "cb77cb5abe1f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.16",
                            "fixed_commit_version": "5.16",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "d76d9d7d1009",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.12",
                            "fixed_commit_version": "5.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "scsi: ufs: core: Fix use-after free in init error and remove paths",
                    "commit": "9c185beae09a3eb85f54777edafa227f7e03075d",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13.3",
                    "version": "6.13.3",
                    "upstream_commit": "f8fb2403ddebb5eea0033d90d9daae4c88749ada",
                    "fixed": [
                        {
                            "fixed_commit": "cb77cb5abe1f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.16",
                            "fixed_commit_version": "5.16",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "d76d9d7d1009",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.12",
                            "fixed_commit_version": "5.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "scsi: ufs: core: Fix use-after free in init error and remove paths",
                    "commit": "f8fb2403ddebb5eea0033d90d9daae4c88749ada",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14",
                    "version": "6.14",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "cb77cb5abe1f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.16",
                            "fixed_commit_version": "5.16",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "d76d9d7d1009",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.12",
                            "fixed_commit_version": "5.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}