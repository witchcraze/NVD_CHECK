{
    "CVE-ID": "CVE-2024-53680",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()\n\nUnder certain kernel configurations when building with Clang/LLVM, the\ncompiler does not generate a return or jump as the terminator\ninstruction for ip_vs_protocol_init(), triggering the following objtool\nwarning during build time:\n\n  vmlinux.o: warning: objtool: ip_vs_protocol_init() falls through to next function __initstub__kmod_ip_vs_rr__935_123_ip_vs_rr_init6()\n\nAt runtime, this either causes an oops when trying to load the ipvs\nmodule or a boot-time panic if ipvs is built-in. This same issue has\nbeen reported by the Intel kernel test robot previously.\n\nDigging deeper into both LLVM and the kernel code reveals this to be a\nundefined behavior problem. ip_vs_protocol_init() uses a on-stack buffer\nof 64 chars to store the registered protocol names and leaves it\nuninitialized after definition. The function calls strnlen() when\nconcatenating protocol names into the buffer. With CONFIG_FORTIFY_SOURCE\nstrnlen() performs an extra step to check whether the last byte of the\ninput char buffer is a null character (commit 3009f891bb9f (\"fortify:\nAllow strlen() and strnlen() to pass compile-time known lengths\")).\nThis, together with possibly other configurations, cause the following\nIR to be generated:\n\n  define hidden i32 @ip_vs_protocol_init() local_unnamed_addr #5 section \".init.text\" align 16 !kcfi_type !29 {\n    %1 = alloca [64 x i8], align 16\n    ...\n\n  14:                                               ; preds = %11\n    %15 = getelementptr inbounds i8, ptr %1, i64 63\n    %16 = load i8, ptr %15, align 1\n    %17 = tail call i1 @llvm.is.constant.i8(i8 %16)\n    %18 = icmp eq i8 %16, 0\n    %19 = select i1 %17, i1 %18, i1 false\n    br i1 %19, label %20, label %23\n\n  20:                                               ; preds = %14\n    %21 = call i64 @strlen(ptr noundef nonnull dereferenceable(1) %1) #23\n    ...\n\n  23:                                               ; preds = %14, %11, %20\n    %24 = call i64 @strnlen(ptr noundef nonnull dereferenceable(1) %1, i64 noundef 64) #24\n    ...\n  }\n\nThe above code calculates the address of the last char in the buffer\n(value %15) and then loads from it (value %16). Because the buffer is\nnever initialized, the LLVM GVN pass marks value %16 as undefined:\n\n  %13 = getelementptr inbounds i8, ptr %1, i64 63\n  br i1 undef, label %14, label %17\n\nThis gives later passes (SCCP, in particular) more DCE opportunities by\npropagating the undef value further, and eventually removes everything\nafter the load on the uninitialized stack location:\n\n  define hidden i32 @ip_vs_protocol_init() local_unnamed_addr #0 section \".init.text\" align 16 !kcfi_type !11 {\n    %1 = alloca [64 x i8], align 16\n    ...\n\n  12:                                               ; preds = %11\n    %13 = getelementptr inbounds i8, ptr %1, i64 63\n    unreachable\n  }\n\nIn this way, the generated native code will just fall through to the\nnext function, as LLVM does not generate any code for the unreachable IR\ninstruction and leaves the function without a terminator.\n\nZero the on-stack buffer to avoid this possible UB.",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 5.5,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel:6.13:rc1",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:2.6.12:rc5",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:2.6.12:rc5:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:2.6.12:rc4",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:2.6.12:rc4:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:2.6.12:rc3",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:2.6.12:rc3:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:2.6.12:rc2",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:2.6.12:rc2:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:2.6.12:-",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:2.6.12:-:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "2.6.13",
                "VersionEndExcluding": "5.4.287",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.11",
                "VersionEndExcluding": "5.15.174",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.16",
                "VersionEndExcluding": "6.1.120",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.5",
                "VersionEndExcluding": "5.10.231",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.2",
                "VersionEndExcluding": "6.6.66",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.7",
                "VersionEndExcluding": "6.12.5",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "5.10.231": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.231"
            ]
        },
        "5.15.174": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.174"
            ]
        },
        "5.4.287": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.287"
            ]
        },
        "6.1.120": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.120"
            ]
        },
        "6.12.5": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.5"
            ]
        },
        "6.13": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13"
            ]
        },
        "6.6.66": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.66"
            ]
        },
        "commit": {
            "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()": [
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "0b2cbed82b7c6504a8a0fbd181f92dd56b432c12",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.231",
                    "version": "5.10.231",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "d6e1776f51c95827142f1d7064118e255e2deec1",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.174",
                    "version": "5.15.174",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "31d1ddc1ce8e8d3f101a679243abb42a313ee88a",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.287",
                    "version": "5.4.287",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "664d0feab92495b6a27edc3d1119e232c0fe8b2b",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.120",
                    "version": "6.1.120",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "48130002e64fd191b7d18efeb4d253fcc23e4688",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.5",
                    "version": "6.12.5",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13",
                    "version": "6.13",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "ipvs: fix UB due to uninitialized stack access in ip_vs_protocol_init()",
                    "commit": "124834133b32f9386bb2d8581d9ab92f65e951e4",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.66",
                    "version": "6.6.66",
                    "upstream_commit": "146b6f1112eb30a19776d6c323c994e9d67790db",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}