{
    "CVE-ID": "CVE-2025-38520",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\ndrm/amdkfd: Don't call mmput from MMU notifier callback\n\nIf the process is exiting, the mmput inside mmu notifier callback from\ncompactd or fork or numa balancing could release the last reference\nof mm struct to call exit_mmap and free_pgtable, this triggers deadlock\nwith below backtrace.\n\nThe deadlock will leak kfd process as mmu notifier release is not called\nand cause VRAM leaking.\n\nThe fix is to take mm reference mmget_non_zero when adding prange to the\ndeferred list to pair with mmput in deferred list work.\n\nIf prange split and add into pchild list, the pchild work_item.mm is not\nused, so remove the mm parameter from svm_range_unmap_split and\nsvm_range_add_child.\n\nThe backtrace of hung task:\n\n INFO: task python:348105 blocked for more than 64512 seconds.\n Call Trace:\n  __schedule+0x1c3/0x550\n  schedule+0x46/0xb0\n  rwsem_down_write_slowpath+0x24b/0x4c0\n  unlink_anon_vmas+0xb1/0x1c0\n  free_pgtables+0xa9/0x130\n  exit_mmap+0xbc/0x1a0\n  mmput+0x5a/0x140\n  svm_range_cpu_invalidate_pagetables+0x2b/0x40 [amdgpu]\n  mn_itree_invalidate+0x72/0xc0\n  __mmu_notifier_invalidate_range_start+0x48/0x60\n  try_to_unmap_one+0x10fa/0x1400\n  rmap_walk_anon+0x196/0x460\n  try_to_unmap+0xbb/0x210\n  migrate_page_unmap+0x54d/0x7e0\n  migrate_pages_batch+0x1c3/0xae0\n  migrate_pages_sync+0x98/0x240\n  migrate_pages+0x25c/0x520\n  compact_zone+0x29d/0x590\n  compact_zone_order+0xb6/0xf0\n  try_to_compact_pages+0xbe/0x220\n  __alloc_pages_direct_compact+0x96/0x1a0\n  __alloc_pages_slowpath+0x410/0x930\n  __alloc_pages_nodemask+0x3a9/0x3e0\n  do_huge_pmd_anonymous_page+0xd7/0x3e0\n  __handle_mm_fault+0x5e3/0x5f0\n  handle_mm_fault+0xf7/0x2e0\n  hmm_vma_fault.isra.0+0x4d/0xa0\n  walk_pmd_range.isra.0+0xa8/0x310\n  walk_pud_range+0x167/0x240\n  walk_pgd_range+0x55/0x100\n  __walk_page_range+0x87/0x90\n  walk_page_range+0xf6/0x160\n  hmm_range_fault+0x4f/0x90\n  amdgpu_hmm_range_get_pages+0x123/0x230 [amdgpu]\n  amdgpu_ttm_tt_get_user_pages+0xb1/0x150 [amdgpu]\n  init_user_pages+0xb1/0x2a0 [amdgpu]\n  amdgpu_amdkfd_gpuvm_alloc_memory_of_gpu+0x543/0x7d0 [amdgpu]\n  kfd_ioctl_alloc_memory_of_gpu+0x24c/0x4e0 [amdgpu]\n  kfd_ioctl+0x29d/0x500 [amdgpu]\n\n(cherry picked from commit a29e067bd38946f752b0ef855f3dfff87e77bec7)",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 5.5,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel:6.16:rc4",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.16:rc3",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.16:rc2",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.16:rc1",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc8",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc8:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc7",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc7:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc6",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc6:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc5",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc5:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc4",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc4:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc3",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc3:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:rc2",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:rc2:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:5.19:-",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:5.19:-:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.15.49",
                "VersionEndExcluding": "5.16",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.18.6",
                "VersionEndExcluding": "5.19",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.19.1",
                "VersionEndExcluding": "6.1.148",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.13",
                "VersionEndExcluding": "6.15.7",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.2",
                "VersionEndExcluding": "6.6.101",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.7",
                "VersionEndExcluding": "6.12.39",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:debian:debian_linux:11.0",
                "FormattedString": "cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "6.1.148": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.148"
            ]
        },
        "6.12.39": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.39"
            ]
        },
        "6.15.7": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.15.7"
            ]
        },
        "6.16": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.16"
            ]
        },
        "6.17": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.17"
            ]
        },
        "6.6.101": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.101"
            ]
        },
        "commit": {
            "drm/amdkfd: Don't call mmput from MMU notifier callback": [
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "c1bde9d48e09933c361521720f77a8072083c83a",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.148",
                    "version": "6.1.148",
                    "upstream_commit": "cf234231fcbc7d391e2135b9518613218cc5347f",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                },
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "e90ee15ce28c61f6d83a0511c3e02e2662478350",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.39",
                    "version": "6.12.39",
                    "upstream_commit": "cf234231fcbc7d391e2135b9518613218cc5347f",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                },
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "a7eb0a25010a674c8fdfbece38353ef7be8c5834",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.15.7",
                    "version": "6.15.7",
                    "upstream_commit": "cf234231fcbc7d391e2135b9518613218cc5347f",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                },
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "cf234231fcbc7d391e2135b9518613218cc5347f",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.16",
                    "version": "6.16",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                },
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "a29e067bd38946f752b0ef855f3dfff87e77bec7",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.17",
                    "version": "6.17",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                },
                {
                    "description": "drm/amdkfd: Don't call mmput from MMU notifier callback",
                    "commit": "145a56bd68f4bff098d59fbc7c263d20dfef4fc4",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.101",
                    "version": "6.6.101",
                    "upstream_commit": "cf234231fcbc7d391e2135b9518613218cc5347f",
                    "fixed": [
                        {
                            "fixed_commit": "fa582c6f3684",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.19",
                            "fixed_commit_version": "5.19",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "09c5cdbc62d9",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.49",
                            "fixed_commit_version": "5.15.49",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        },
                        {
                            "fixed_commit": "4b29b8d7c20f",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18.6",
                            "fixed_commit_version": "5.18.6",
                            "fixed_commit_upstream_commit": "fa582c6f3684ac0098a9d02ddf0ed52a02b37127"
                        }
                    ]
                }
            ]
        }
    }
}