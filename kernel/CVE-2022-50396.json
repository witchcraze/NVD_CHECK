{
    "CVE-ID": "CVE-2022-50396",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet: sched: fix memory leak in tcindex_set_parms\n\nSyzkaller reports a memory leak as follows:\n====================================\nBUG: memory leak\nunreferenced object 0xffff88810c287f00 (size 256):\n  comm \"syz-executor105\", pid 3600, jiffies 4294943292 (age 12.990s)\n  hex dump (first 32 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<ffffffff814cf9f0>] kmalloc_trace+0x20/0x90 mm/slab_common.c:1046\n    [<ffffffff839c9e07>] kmalloc include/linux/slab.h:576 [inline]\n    [<ffffffff839c9e07>] kmalloc_array include/linux/slab.h:627 [inline]\n    [<ffffffff839c9e07>] kcalloc include/linux/slab.h:659 [inline]\n    [<ffffffff839c9e07>] tcf_exts_init include/net/pkt_cls.h:250 [inline]\n    [<ffffffff839c9e07>] tcindex_set_parms+0xa7/0xbe0 net/sched/cls_tcindex.c:342\n    [<ffffffff839caa1f>] tcindex_change+0xdf/0x120 net/sched/cls_tcindex.c:553\n    [<ffffffff8394db62>] tc_new_tfilter+0x4f2/0x1100 net/sched/cls_api.c:2147\n    [<ffffffff8389e91c>] rtnetlink_rcv_msg+0x4dc/0x5d0 net/core/rtnetlink.c:6082\n    [<ffffffff839eba67>] netlink_rcv_skb+0x87/0x1d0 net/netlink/af_netlink.c:2540\n    [<ffffffff839eab87>] netlink_unicast_kernel net/netlink/af_netlink.c:1319 [inline]\n    [<ffffffff839eab87>] netlink_unicast+0x397/0x4c0 net/netlink/af_netlink.c:1345\n    [<ffffffff839eb046>] netlink_sendmsg+0x396/0x710 net/netlink/af_netlink.c:1921\n    [<ffffffff8383e796>] sock_sendmsg_nosec net/socket.c:714 [inline]\n    [<ffffffff8383e796>] sock_sendmsg+0x56/0x80 net/socket.c:734\n    [<ffffffff8383eb08>] ____sys_sendmsg+0x178/0x410 net/socket.c:2482\n    [<ffffffff83843678>] ___sys_sendmsg+0xa8/0x110 net/socket.c:2536\n    [<ffffffff838439c5>] __sys_sendmmsg+0x105/0x330 net/socket.c:2622\n    [<ffffffff83843c14>] __do_sys_sendmmsg net/socket.c:2651 [inline]\n    [<ffffffff83843c14>] __se_sys_sendmmsg net/socket.c:2648 [inline]\n    [<ffffffff83843c14>] __x64_sys_sendmmsg+0x24/0x30 net/socket.c:2648\n    [<ffffffff84605fd5>] do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n    [<ffffffff84605fd5>] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80\n    [<ffffffff84800087>] entry_SYSCALL_64_after_hwframe+0x63/0xcd\n====================================\n\nKernel uses tcindex_change() to change an existing\nfilter properties.\n\nYet the problem is that, during the process of changing,\nif `old_r` is retrieved from `p->perfect`, then\nkernel uses tcindex_alloc_perfect_hash() to newly\nallocate filter results, uses tcindex_filter_result_init()\nto clear the old filter result, without destroying\nits tcf_exts structure, which triggers the above memory leak.\n\nTo be more specific, there are only two source for the `old_r`,\naccording to the tcindex_lookup(). `old_r` is retrieved from\n`p->perfect`, or `old_r` is retrieved from `p->h`.\n\n  * If `old_r` is retrieved from `p->perfect`, kernel uses\ntcindex_alloc_perfect_hash() to newly allocate the\nfilter results. Then `r` is assigned with `cp->perfect + handle`,\nwhich is newly allocated. So condition `old_r && old_r != r` is\ntrue in this situation, and kernel uses tcindex_filter_result_init()\nto clear the old filter result, without destroying\nits tcf_exts structure\n\n  * If `old_r` is retrieved from `p->h`, then `p->perfect` is NULL\naccording to the tcindex_lookup(). Considering that `cp->h`\nis directly copied from `p->h` and `p->perfect` is NULL,\n`r` is assigned with `tcindex_lookup(cp, handle)`, whose value\nshould be the same as `old_r`, so condition `old_r && old_r != r`\nis false in this situation, kernel ignores using\ntcindex_filter_result_init() to clear the old filter result.\n\nSo only when `old_r` is retrieved from `p->perfect` does kernel use\ntcindex_filter_result_init() to clear the old filter result, which\ntriggers the above memory leak.\n\nConsidering that there already exists a tc_filter_wq workqueue\nto destroy the old tcindex_d\n---truncated---",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 5.5,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.15",
                "VersionEndExcluding": "4.19.276",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.20",
                "VersionEndExcluding": "5.4.235",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.9",
                "VersionEndExcluding": "4.14.308",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.11",
                "VersionEndExcluding": "5.15.100",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.16",
                "VersionEndExcluding": "6.0.19",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.5",
                "VersionEndExcluding": "5.10.173",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.1",
                "VersionEndExcluding": "6.1.18",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.2",
                "VersionEndExcluding": "6.2.5",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "5.10.163": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.163"
            ]
        },
        "5.15.87": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.87"
            ]
        },
        "5.4.229": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.229"
            ]
        },
        "6.0.19": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.0.19"
            ]
        },
        "6.1.5": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.5"
            ]
        },
        "6.2": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.2"
            ]
        },
        "commit": {
            "net: sched: fix memory leak in tcindex_set_parms": [
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "b314f6c3512108d7a656c5caf07c82d1bbbdc0f1",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.163",
                    "version": "5.10.163",
                    "upstream_commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "6c55953e232ea668731091d111066521f3b7719b",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.87",
                    "version": "5.15.87",
                    "upstream_commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "55ac68b53f1cea1926ee2313afc5d66b91daad71",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.229",
                    "version": "5.4.229",
                    "upstream_commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "c4de6057e7c6654983acb63d939d26ac0d7bbf39",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.0.19",
                    "version": "6.0.19",
                    "upstream_commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "facc4405e8b7407e03216207b1d1d640127de0c8",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.5",
                    "version": "6.1.5",
                    "upstream_commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: sched: fix memory leak in tcindex_set_parms",
                    "commit": "399ab7fe0fa0d846881685fd4e57e9a8ef7559f7",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.2",
                    "version": "6.2",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "b9a24bb76bf6",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/b9a24bb76bf6",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}