{
    "CVE-ID": "CVE-2021-47656",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\njffs2: fix use-after-free in jffs2_clear_xattr_subsystem\n\nWhen we mount a jffs2 image, assume that the first few blocks of\nthe image are normal and contain at least one xattr-related inode,\nbut the next block is abnormal. As a result, an error is returned\nin jffs2_scan_eraseblock(). jffs2_clear_xattr_subsystem() is then\ncalled in jffs2_build_filesystem() and then again in\njffs2_do_fill_super().\n\nFinally we can observe the following report:\n ==================================================================\n BUG: KASAN: use-after-free in jffs2_clear_xattr_subsystem+0x95/0x6ac\n Read of size 8 at addr ffff8881243384e0 by task mount/719\n\n Call Trace:\n  dump_stack+0x115/0x16b\n  jffs2_clear_xattr_subsystem+0x95/0x6ac\n  jffs2_do_fill_super+0x84f/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n  mtd_get_sb+0x254/0x400\n  mtd_get_sb_by_nr+0x4f/0xd0\n  get_tree_mtd+0x498/0x840\n  jffs2_get_tree+0x25/0x30\n  vfs_get_tree+0x8d/0x2e0\n  path_mount+0x50f/0x1e50\n  do_mount+0x107/0x130\n  __se_sys_mount+0x1c5/0x2f0\n  __x64_sys_mount+0xc7/0x160\n  do_syscall_64+0x45/0x70\n  entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\n Allocated by task 719:\n  kasan_save_stack+0x23/0x60\n  __kasan_kmalloc.constprop.0+0x10b/0x120\n  kasan_slab_alloc+0x12/0x20\n  kmem_cache_alloc+0x1c0/0x870\n  jffs2_alloc_xattr_ref+0x2f/0xa0\n  jffs2_scan_medium.cold+0x3713/0x4794\n  jffs2_do_mount_fs.cold+0xa7/0x2253\n  jffs2_do_fill_super+0x383/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n [...]\n\n Freed by task 719:\n  kmem_cache_free+0xcc/0x7b0\n  jffs2_free_xattr_ref+0x78/0x98\n  jffs2_clear_xattr_subsystem+0xa1/0x6ac\n  jffs2_do_mount_fs.cold+0x5e6/0x2253\n  jffs2_do_fill_super+0x383/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n [...]\n\n The buggy address belongs to the object at ffff8881243384b8\n  which belongs to the cache jffs2_xattr_ref of size 48\n The buggy address is located 40 bytes inside of\n  48-byte region [ffff8881243384b8, ffff8881243384e8)\n [...]\n ==================================================================\n\nThe triggering of the BUG is shown in the following stack:\n-----------------------------------------------------------\njffs2_fill_super\n  jffs2_do_fill_super\n    jffs2_do_mount_fs\n      jffs2_build_filesystem\n        jffs2_scan_medium\n          jffs2_scan_eraseblock        <--- ERROR\n        jffs2_clear_xattr_subsystem    <--- free\n    jffs2_clear_xattr_subsystem        <--- free again\n-----------------------------------------------------------\n\nAn error is returned in jffs2_do_mount_fs(). If the error is returned\nby jffs2_sum_init(), the jffs2_clear_xattr_subsystem() does not need to\nbe executed. If the error is returned by jffs2_build_filesystem(), the\njffs2_clear_xattr_subsystem() also does not need to be executed again.\nSo move jffs2_clear_xattr_subsystem() from 'out_inohash' to 'out_root'\nto fix this UAF problem.",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 7.8,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "2.6.18",
                "VersionEndExcluding": "4.9.311",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.10",
                "VersionEndExcluding": "4.14.276",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.15",
                "VersionEndExcluding": "4.19.238",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.20",
                "VersionEndExcluding": "5.4.189",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.11",
                "VersionEndExcluding": "5.15.33",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.16",
                "VersionEndExcluding": "5.16.19",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.17",
                "VersionEndExcluding": "5.17.2",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.5",
                "VersionEndExcluding": "5.10.110",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "4.14.276": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.14.276"
            ]
        },
        "4.19.238": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.19.238"
            ]
        },
        "4.9.311": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.9.311"
            ]
        },
        "5.10.110": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.110"
            ]
        },
        "5.15.33": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.33"
            ]
        },
        "5.16.19": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.16.19"
            ]
        },
        "5.17.2": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.17.2"
            ]
        },
        "5.18": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18"
            ]
        },
        "5.4.189": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.189"
            ]
        },
        "commit": {
            "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem": [
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "3bd2454162ec6bbb5503233c804fce6e4b6dcec5",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.14.276",
                    "version": "4.14.276",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "c3b07c875fa8f906f932976460fd14798596f101",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.19.238",
                    "version": "4.19.238",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "9150cb625b46f68d524f4cfd491f1aafc23e10a9",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.9.311",
                    "version": "4.9.311",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "7bb7428dd73991bf4b3a7a61b493ca50046c2b13",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.110",
                    "version": "5.10.110",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "7a75740206af5f17e9f3efa384211cba70213da1",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.33",
                    "version": "5.15.33",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "22327bd7988f21de3a53c1373f3b81542bfe1f44",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.16.19",
                    "version": "5.16.19",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "8c0f024f29e055840a5a89fe23b96ae3f921afed",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.17.2",
                    "version": "5.17.2",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.18",
                    "version": "5.18",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "jffs2: fix use-after-free in jffs2_clear_xattr_subsystem",
                    "commit": "30bf7244acf32f19cb722c39f7bc1c2a9f300422",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.189",
                    "version": "5.4.189",
                    "upstream_commit": "4c7c44ee1650677fbe89d86edbad9497b7679b5c",
                    "fixed": [
                        {
                            "fixed_commit": "aa98d7cf59b5",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/aa98d7cf59b5",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}