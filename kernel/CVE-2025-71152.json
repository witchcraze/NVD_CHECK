{
    "CVE-ID": "CVE-2025-71152",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet: dsa: properly keep track of conduit reference\n\nProblem description\n-------------------\n\nDSA has a mumbo-jumbo of reference handling of the conduit net device\nand its kobject which, sadly, is just wrong and doesn't make sense.\n\nThere are two distinct problems.\n\n1. The OF path, which uses of_find_net_device_by_node(), never releases\n   the elevated refcount on the conduit's kobject. Nominally, the OF and\n   non-OF paths should result in objects having identical reference\n   counts taken, and it is already suspicious that\n   dsa_dev_to_net_device() has a put_device() call which is missing in\n   dsa_port_parse_of(), but we can actually even verify that an issue\n   exists. With CONFIG_DEBUG_KOBJECT_RELEASE=y, if we run this command\n   \"before\" and \"after\" applying this patch:\n\n(unbind the conduit driver for net device eno2)\necho 0000:00:00.2 > /sys/bus/pci/drivers/fsl_enetc/unbind\n\nwe see these lines in the output diff which appear only with the patch\napplied:\n\nkobject: 'eno2' (ffff002009a3a6b8): kobject_release, parent 0000000000000000 (delayed 1000)\nkobject: '109' (ffff0020099d59a0): kobject_release, parent 0000000000000000 (delayed 1000)\n\n2. After we find the conduit interface one way (OF) or another (non-OF),\n   it can get unregistered at any time, and DSA remains with a long-lived,\n   but in this case stale, cpu_dp->conduit pointer. Holding the net\n   device's underlying kobject isn't actually of much help, it just\n   prevents it from being freed (but we never need that kobject\n   directly). What helps us to prevent the net device from being\n   unregistered is the parallel netdev reference mechanism (dev_hold()\n   and dev_put()).\n\nActually we actually use that netdev tracker mechanism implicitly on\nuser ports since commit 2f1e8ea726e9 (\"net: dsa: link interfaces with\nthe DSA master to get rid of lockdep warnings\"), via netdev_upper_dev_link().\nBut time still passes at DSA switch probe time between the initial\nof_find_net_device_by_node() code and the user port creation time, time\nduring which the conduit could unregister itself and DSA wouldn't know\nabout it.\n\nSo we have to run of_find_net_device_by_node() under rtnl_lock() to\nprevent that from happening, and release the lock only with the netdev\ntracker having acquired the reference.\n\nDo we need to keep the reference until dsa_unregister_switch() /\ndsa_switch_shutdown()?\n1: Maybe yes. A switch device will still be registered even if all user\n   ports failed to probe, see commit 86f8b1c01a0a (\"net: dsa: Do not\n   make user port errors fatal\"), and the cpu_dp->conduit pointers\n   remain valid.  I haven't audited all call paths to see whether they\n   will actually use the conduit in lack of any user port, but if they\n   do, it seems safer to not rely on user ports for that reference.\n2. Definitely yes. We support changing the conduit which a user port is\n   associated to, and we can get into a situation where we've moved all\n   user ports away from a conduit, thus no longer hold any reference to\n   it via the net device tracker. But we shouldn't let it go nonetheless\n   - see the next change in relation to dsa_tree_find_first_conduit()\n   and LAG conduits which disappear.\n   We have to be prepared to return to the physical conduit, so the CPU\n   port must explicitly keep another reference to it. This is also to\n   say: the user ports and their CPU ports may not always keep a\n   reference to the same conduit net device, and both are needed.\n\nAs for the conduit's kobject for the /sys/class/net/ entry, we don't\ncare about it, we can release it as soon as we hold the net device\nobject itself.\n\nHistory and blame attribution\n-----------------------------\n\nThe code has been refactored so many times, it is very difficult to\nfollow and properly attribute a blame, but I'll try to make a short\nhistory which I hope to be correct.\n\nWe have two distinct probing paths:\n- one for OF, introduced in 2016 i\n---truncated---",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 7.8,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel:6.19:rc3",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.19:rc3:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.19:rc2",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.19:rc2:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.19:rc1",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.19:rc1:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.8",
                "VersionEndExcluding": "6.18.4",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "6.18.4": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.18.4"
            ]
        },
        "6.19": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.19"
            ]
        },
        "commit": {
            "net: dsa: properly keep track of conduit reference": [
                {
                    "description": "net: dsa: properly keep track of conduit reference",
                    "commit": "0e766b77ba5093583dfe609fae0aa1545c46dbbd",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.18.4",
                    "version": "6.18.4",
                    "upstream_commit": "06e219f6a706c367c93051f408ac61417643d2f9",
                    "fixed": [
                        {
                            "fixed_commit": "83c0afaec7b7",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/83c0afaec7b7",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "71e0bbde0d88",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/71e0bbde0d88",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "net: dsa: properly keep track of conduit reference",
                    "commit": "06e219f6a706c367c93051f408ac61417643d2f9",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.19",
                    "version": "6.19",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "83c0afaec7b7",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/83c0afaec7b7",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "71e0bbde0d88",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/71e0bbde0d88",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        },
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}