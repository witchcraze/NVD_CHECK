{
    "CVE-ID": "CVE-2025-21861",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nmm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()\n\nIf migration succeeded, we called\nfolio_migrate_flags()->mem_cgroup_migrate() to migrate the memcg from the\nold to the new folio.  This will set memcg_data of the old folio to 0.\n\nSimilarly, if migration failed, memcg_data of the dst folio is left unset.\n\nIf we call folio_putback_lru() on such folios (memcg_data == 0), we will\nadd the folio to be freed to the LRU, making memcg code unhappy.  Running\nthe hmm selftests:\n\n  # ./hmm-tests\n  ...\n  #  RUN           hmm.hmm_device_private.migrate ...\n  [  102.078007][T14893] page: refcount:1 mapcount:0 mapping:0000000000000000 index:0x7ff27d200 pfn:0x13cc00\n  [  102.079974][T14893] anon flags: 0x17ff00000020018(uptodate|dirty|swapbacked|node=0|zone=2|lastcpupid=0x7ff)\n  [  102.082037][T14893] raw: 017ff00000020018 dead000000000100 dead000000000122 ffff8881353896c9\n  [  102.083687][T14893] raw: 00000007ff27d200 0000000000000000 00000001ffffffff 0000000000000000\n  [  102.085331][T14893] page dumped because: VM_WARN_ON_ONCE_FOLIO(!memcg && !mem_cgroup_disabled())\n  [  102.087230][T14893] ------------[ cut here ]------------\n  [  102.088279][T14893] WARNING: CPU: 0 PID: 14893 at ./include/linux/memcontrol.h:726 folio_lruvec_lock_irqsave+0x10e/0x170\n  [  102.090478][T14893] Modules linked in:\n  [  102.091244][T14893] CPU: 0 UID: 0 PID: 14893 Comm: hmm-tests Not tainted 6.13.0-09623-g6c216bc522fd #151\n  [  102.093089][T14893] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-2.fc40 04/01/2014\n  [  102.094848][T14893] RIP: 0010:folio_lruvec_lock_irqsave+0x10e/0x170\n  [  102.096104][T14893] Code: ...\n  [  102.099908][T14893] RSP: 0018:ffffc900236c37b0 EFLAGS: 00010293\n  [  102.101152][T14893] RAX: 0000000000000000 RBX: ffffea0004f30000 RCX: ffffffff8183f426\n  [  102.102684][T14893] RDX: ffff8881063cb880 RSI: ffffffff81b8117f RDI: ffff8881063cb880\n  [  102.104227][T14893] RBP: 0000000000000000 R08: 0000000000000005 R09: 0000000000000000\n  [  102.105757][T14893] R10: 0000000000000001 R11: 0000000000000002 R12: ffffc900236c37d8\n  [  102.107296][T14893] R13: ffff888277a2bcb0 R14: 000000000000001f R15: 0000000000000000\n  [  102.108830][T14893] FS:  00007ff27dbdd740(0000) GS:ffff888277a00000(0000) knlGS:0000000000000000\n  [  102.110643][T14893] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  [  102.111924][T14893] CR2: 00007ff27d400000 CR3: 000000010866e000 CR4: 0000000000750ef0\n  [  102.113478][T14893] PKRU: 55555554\n  [  102.114172][T14893] Call Trace:\n  [  102.114805][T14893]  <TASK>\n  [  102.115397][T14893]  ? folio_lruvec_lock_irqsave+0x10e/0x170\n  [  102.116547][T14893]  ? __warn.cold+0x110/0x210\n  [  102.117461][T14893]  ? folio_lruvec_lock_irqsave+0x10e/0x170\n  [  102.118667][T14893]  ? report_bug+0x1b9/0x320\n  [  102.119571][T14893]  ? handle_bug+0x54/0x90\n  [  102.120494][T14893]  ? exc_invalid_op+0x17/0x50\n  [  102.121433][T14893]  ? asm_exc_invalid_op+0x1a/0x20\n  [  102.122435][T14893]  ? __wake_up_klogd.part.0+0x76/0xd0\n  [  102.123506][T14893]  ? dump_page+0x4f/0x60\n  [  102.124352][T14893]  ? folio_lruvec_lock_irqsave+0x10e/0x170\n  [  102.125500][T14893]  folio_batch_move_lru+0xd4/0x200\n  [  102.126577][T14893]  ? __pfx_lru_add+0x10/0x10\n  [  102.127505][T14893]  __folio_batch_add_and_move+0x391/0x720\n  [  102.128633][T14893]  ? __pfx_lru_add+0x10/0x10\n  [  102.129550][T14893]  folio_putback_lru+0x16/0x80\n  [  102.130564][T14893]  migrate_device_finalize+0x9b/0x530\n  [  102.131640][T14893]  dmirror_migrate_to_device.constprop.0+0x7c5/0xad0\n  [  102.133047][T14893]  dmirror_fops_unlocked_ioctl+0x89b/0xc80\n\nLikely, nothing else goes wrong: putting the last folio reference will\nremove the folio from the LRU again.  So besides memcg complaining, adding\nthe folio to be freed to the LRU is just an unnecessary step.\n\nThe new flow resembles what we have in migrate_folio_move(): add the dst\nto the lru, rem\n---truncated---",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 5.5,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel:6.14:rc3",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.14:rc2",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel:6.14:rc1",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "",
                "VersionEndExcluding": "",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.14",
                "VersionEndExcluding": "6.12.17",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "6.13",
                "VersionEndExcluding": "6.13.5",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "5.10.245": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.245"
            ]
        },
        "5.15.194": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.194"
            ]
        },
        "5.4.300": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.300"
            ]
        },
        "6.1.155": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.155"
            ]
        },
        "6.12.17": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.17"
            ]
        },
        "6.13.5": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13.5"
            ]
        },
        "6.14": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14"
            ]
        },
        "6.6.109": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.109"
            ]
        },
        "commit": {
            "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()": [
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "64397b0cb7c09e3ef3f9f5c7c17299c4eebd3875",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.245",
                    "version": "5.10.245",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "4f52f7c50f5b6f5eeb06823e21fe546d90f9c595",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.194",
                    "version": "5.15.194",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "61fa824e304ed162fe965f64999068e6fcff2059",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.300",
                    "version": "5.4.300",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "20fb6fc51863fbff7868de8b5f6d249d2094df1f",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1.155",
                    "version": "6.1.155",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "3f9240d59e9a95d19f06120bfd1d0e681c6c0ac7",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.12.17",
                    "version": "6.12.17",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "069dd21ea8262204f94737878389c2815a054a9e",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.13.5",
                    "version": "6.13.5",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.14",
                    "version": "6.14",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                },
                {
                    "description": "mm/migrate_device: don't add folio to be freed to LRU in migrate_device_finalize()",
                    "commit": "78f579cb7d825134e071a1714d8d0c4fd0ffe459",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.6.109",
                    "version": "6.6.109",
                    "upstream_commit": "41cddf83d8b00f29fd105e7a0777366edc69a5cf",
                    "fixed": [
                        {
                            "fixed_commit": "8763cb45ab96",
                            "fixed_commit_source": "https://github.com/torvalds/linux/commit/8763cb45ab96",
                            "fixed_commit_version": "-",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}