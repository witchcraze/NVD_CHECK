{
    "CVE-ID": "CVE-2022-50432",
    "NVD": {
        "Descriptions": "In the Linux kernel, the following vulnerability has been resolved:\n\nkernfs: fix use-after-free in __kernfs_remove\n\nSyzkaller managed to trigger concurrent calls to\nkernfs_remove_by_name_ns() for the same file resulting in\na KASAN detected use-after-free. The race occurs when the root\nnode is freed during kernfs_drain().\n\nTo prevent this acquire an additional reference for the root\nof the tree that is removed before calling __kernfs_remove().\n\nFound by syzkaller with the following reproducer (slab_nomerge is\nrequired):\n\nsyz_mount_image$ext4(0x0, &(0x7f0000000100)='./file0\\x00', 0x100000, 0x0, 0x0, 0x0, 0x0)\nr0 = openat(0xffffffffffffff9c, &(0x7f0000000080)='/proc/self/exe\\x00', 0x0, 0x0)\nclose(r0)\npipe2(&(0x7f0000000140)={0xffffffffffffffff, <r1=>0xffffffffffffffff}, 0x800)\nmount$9p_fd(0x0, &(0x7f0000000040)='./file0\\x00', &(0x7f00000000c0), 0x408, &(0x7f0000000280)={'trans=fd,', {'rfdno', 0x3d, r0}, 0x2c, {'wfdno', 0x3d, r1}, 0x2c, {[{@cache_loose}, {@mmap}, {@loose}, {@loose}, {@mmap}], [{@mask={'mask', 0x3d, '^MAY_EXEC'}}, {@fsmagic={'fsmagic', 0x3d, 0x10001}}, {@dont_hash}]}})\n\nSample report:\n\n==================================================================\nBUG: KASAN: use-after-free in kernfs_type include/linux/kernfs.h:335 [inline]\nBUG: KASAN: use-after-free in kernfs_leftmost_descendant fs/kernfs/dir.c:1261 [inline]\nBUG: KASAN: use-after-free in __kernfs_remove.part.0+0x843/0x960 fs/kernfs/dir.c:1369\nRead of size 2 at addr ffff8880088807f0 by task syz-executor.2/857\n\nCPU: 0 PID: 857 Comm: syz-executor.2 Not tainted 6.0.0-rc3-00363-g7726d4c3e60b #5\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0x6e/0x91 lib/dump_stack.c:106\n print_address_description mm/kasan/report.c:317 [inline]\n print_report.cold+0x5e/0x5e5 mm/kasan/report.c:433\n kasan_report+0xa3/0x130 mm/kasan/report.c:495\n kernfs_type include/linux/kernfs.h:335 [inline]\n kernfs_leftmost_descendant fs/kernfs/dir.c:1261 [inline]\n __kernfs_remove.part.0+0x843/0x960 fs/kernfs/dir.c:1369\n __kernfs_remove fs/kernfs/dir.c:1356 [inline]\n kernfs_remove_by_name_ns+0x108/0x190 fs/kernfs/dir.c:1589\n sysfs_slab_add+0x133/0x1e0 mm/slub.c:5943\n __kmem_cache_create+0x3e0/0x550 mm/slub.c:4899\n create_cache mm/slab_common.c:229 [inline]\n kmem_cache_create_usercopy+0x167/0x2a0 mm/slab_common.c:335\n p9_client_create+0xd4d/0x1190 net/9p/client.c:993\n v9fs_session_init+0x1e6/0x13c0 fs/9p/v9fs.c:408\n v9fs_mount+0xb9/0xbd0 fs/9p/vfs_super.c:126\n legacy_get_tree+0xf1/0x200 fs/fs_context.c:610\n vfs_get_tree+0x85/0x2e0 fs/super.c:1530\n do_new_mount fs/namespace.c:3040 [inline]\n path_mount+0x675/0x1d00 fs/namespace.c:3370\n do_mount fs/namespace.c:3383 [inline]\n __do_sys_mount fs/namespace.c:3591 [inline]\n __se_sys_mount fs/namespace.c:3568 [inline]\n __x64_sys_mount+0x282/0x300 fs/namespace.c:3568\n do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n do_syscall_64+0x38/0x90 arch/x86/entry/common.c:80\n entry_SYSCALL_64_after_hwframe+0x63/0xcd\nRIP: 0033:0x7f725f983aed\nCode: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 b0 ff ff ff f7 d8 64 89 01 48\nRSP: 002b:00007f725f0f7028 EFLAGS: 00000246 ORIG_RAX: 00000000000000a5\nRAX: ffffffffffffffda RBX: 00007f725faa3f80 RCX: 00007f725f983aed\nRDX: 00000000200000c0 RSI: 0000000020000040 RDI: 0000000000000000\nRBP: 00007f725f9f419c R08: 0000000020000280 R09: 0000000000000000\nR10: 0000000000000408 R11: 0000000000000246 R12: 0000000000000000\nR13: 0000000000000006 R14: 00007f725faa3f80 R15: 00007f725f0d7000\n </TASK>\n\nAllocated by task 855:\n kasan_save_stack+0x1e/0x40 mm/kasan/common.c:38\n kasan_set_track mm/kasan/common.c:45 [inline]\n set_alloc_info mm/kasan/common.c:437 [inline]\n __kasan_slab_alloc+0x66/0x80 mm/kasan/common.c:470\n kasan_slab_alloc include/linux/kasan.h:224 [inline]\n slab_post_alloc_hook mm/slab.h:7\n---truncated---",
        "Cvss2_BaseScore": 0,
        "Cvss3_BaseScore": 7.8,
        "Cvss2_VectorString": "",
        "Cvss3_VectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
        "CPEs": [
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "3.14",
                "VersionEndExcluding": "4.9.332",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.10",
                "VersionEndExcluding": "4.14.298",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.15",
                "VersionEndExcluding": "4.19.264",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "4.20",
                "VersionEndExcluding": "5.4.223",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.11",
                "VersionEndExcluding": "5.15.77",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.16",
                "VersionEndExcluding": "6.0.7",
                "VersionEndIncluding": ""
            },
            {
                "URI": "cpe:/o:linux:linux_kernel",
                "FormattedString": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*",
                "VersionStartExcluding": "",
                "VersionStartIncluding": "5.5",
                "VersionEndExcluding": "5.10.153",
                "VersionEndIncluding": ""
            }
        ]
    },
    "Official": {
        "4.14.298": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.14.298"
            ]
        },
        "4.19.264": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.19.264"
            ]
        },
        "4.9.332": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.9.332"
            ]
        },
        "5.10.153": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.153"
            ]
        },
        "5.15.77": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.77"
            ]
        },
        "5.4.223": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.223"
            ]
        },
        "6.0.7": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.0.7"
            ]
        },
        "6.1": {
            "source": [
                "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1"
            ]
        },
        "commit": {
            "kernfs: fix use-after-free in __kernfs_remove": [
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "02eb35131050735332658029082f61515b7dfe38",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.14.298",
                    "version": "4.14.298",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "028cf780743eea79abffa7206b9dcfc080ad3546",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.19.264",
                    "version": "4.19.264",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "4dfd6a477a1525773469feaf3c514b2c0fef76b5",
                    "source": "https://www.kernel.org/pub//linux/kernel/v4.x/ChangeLog-4.9.332",
                    "version": "4.9.332",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "6f72a3977ba9d0e5491a5c01315204272e7f9c44",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.10.153",
                    "version": "5.10.153",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "94d2643df1e70a4c310ebb5e2c493eec33df1a06",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.15.77",
                    "version": "5.15.77",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "c78b0dc6fb7fb389d674e491fd376388cdfb1d53",
                    "source": "https://www.kernel.org/pub//linux/kernel/v5.x/ChangeLog-5.4.223",
                    "version": "5.4.223",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "af1b57cc39beca203559576b3046094fc9e5eb32",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.0.7",
                    "version": "6.0.7",
                    "upstream_commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "fixed": []
                },
                {
                    "description": "kernfs: fix use-after-free in __kernfs_remove",
                    "commit": "4abc99652812a2ddf932f137515d5c5a04723538",
                    "source": "https://www.kernel.org/pub//linux/kernel/v6.x/ChangeLog-6.1",
                    "version": "6.1",
                    "upstream_commit": "",
                    "fixed": [
                        {
                            "fixed_commit": "1da177e4c3f4",
                            "fixed_commit_source": "https://www.kernel.org/pub//linux/kernel/v2.6/ChangeLog-2.6.12",
                            "fixed_commit_version": "2.6.12",
                            "fixed_commit_upstream_commit": []
                        }
                    ]
                }
            ]
        }
    }
}